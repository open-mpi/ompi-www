<html>
<head>
<style><!--
.hmmessage P
{
margin:0px;
padding:0px
}
body.hmmessage
{
font-size: 10pt;
font-family:Verdana
}
--></style>
</head>
<body class='hmmessage'>
Thank you very much Ralph for your help. <br><br>

<base>&gt;I'm having a little trouble following this email thread, so forgive any misunderstanding.<div><br></div><div>&gt;If I understand this correctly, you are able to correctly run if you provide a -hostfile option. The issue is that mpirun does not &gt;appear to be picking up the PBS_NODEFILE automatically and using it - correct?</div><div><br>That's correct<br></div><div><br>&gt;If that is true, then the problem is most likely that mpirun isn't finding the file. There should be an environmental variable &gt;$PBS_NODEFILE that contains the full path to the file. Also, that file (and the entire path to it) must be readable by the user.</div><div><br></div><div>&gt;Can you check that this is the case?</div>The file exist and the user can read it. I can actually cat its content from the PBS script I am running.<br><br>With Best Begards.<br>~Belaid.<br><br><div><div><div>On Dec 1, 2009, at 4:08 PM, Belaid MOA wrote:</div><br class="ecxApple-interchange-newline"><blockquote><span class="ecxApple-style-span" style="border-collapse: separate; font-family: Helvetica; font-size: medium; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: normal; text-indent: 0px; text-transform: none; white-space: normal; word-spacing: 0px;"><div class="ecxhmmessage" style="font-size: 10pt; font-family: Verdana;">I tried -bynode option but it did not change anything. I also tried the "hostname" name command and<span class="ecxApple-converted-space">&nbsp;</span><br>I keep getting only the name of one node repeated according to the -n value.<span class="ecxApple-converted-space">&nbsp;</span><br><br>Just to make sure I did the right installation, here is what I did:<span class="ecxApple-converted-space">&nbsp;</span><br><br>-- On the head node (HN), I installed openMPI using the --with-tm option as follows:<br><br>./configure --with-tm=/var/spool/torque --enable-static<br>make install all<br><br>-- On the worker nodes (WN1 and WN2), I installed openMPI without tm option as follows (it is a local installation on each worker node):<br><br>./configure --enable-static<br>make install all<br><br>Is this correct?<span class="ecxApple-converted-space">&nbsp;</span><br><br>Thanks a lot in advance.<br>~Belaid.<br>&gt; Date: Tue, 1 Dec 2009 17:07:58 -0500<br>&gt; From:<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:gus@ldeo.columbia.edu">gus@ldeo.columbia.edu</a><br>&gt; To:<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; Subject: Re: [OMPI users] mpirun is using one PBS node only<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Hi Belaid Moa<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Belaid MOA wrote:<br>&gt; &gt; Thanks a lot Gus for you help again. I only have one CPU per node.<br>&gt; &gt; The -n X option (no matter what the value of X is) shows X processes<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; running on one node only (the other one is free).<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; So, somehow it is oversubscribing your single processor<br>&gt; on the first node.<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; A simple diagnostic:<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Have you tried to run "hostname" on the two nodes through Torque/PBS<br>&gt; and mpiexec?<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; [PBS directives, cd $PBS_O_WORKDIR, etc]<br>&gt; ...<br>&gt; /full/path/to/openmpi/bin/mpiexec -n 2 hostname<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Try also with the -byslot and -bynode options.<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; If I add the machinefile option with WN1 and WN2 in it, the right<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; behavior is manifested. According to the documentation,<br>&gt; &gt; mpirun should get the PBS_NODEFILE automatically from the PBS.<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Yes, if you compiled OpenMPI you are using with Torque ("tm) support.<br>&gt; Did you?<br>&gt; Make sure the it has tm support.<br>&gt; Run "ompi_info" with full path if needed, to check that.<br>&gt; Are you sure the correct path to what you want is<br>&gt; /usr/local/bin/mpirun ?<br>&gt; Linux distributions, compilers, and other tools come with their<br>&gt; mpiexec and put them in places that you may not suspect, to better<br>&gt; double check you get what you want.<br>&gt; That has been a source of repeated confusion on this and other<br>&gt; mailing lists.<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Also, make sure that passwordless ssh across the nodes is working.<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Yet another thing to check, for easy name resolution,<br>&gt; your /etc/hosts file on *all*<br>&gt; nodes including the headnode should<br>&gt; have a list of all nodes and their IP addresses.<br>&gt; Something like this:<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; 127.0.0.1	localhost.localdomain	localhost<br>&gt; 192.168.0.1 WN1<br>&gt; 192.168.0.2 WN2<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; (The IPs above are guesswork of mine, you know better which to use.)<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; So, I do<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; not need to use machinefile.<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; True assuming the first condition above (OpenMPI *with* "tm" suport).<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; Any ideas?<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Yes, and I sent it to you on my last email!<br>&gt; Try the "-bynode" option of mpiexec.<br>&gt; ("man mpiexec" is your friend!)<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; Thanks a lot in advance.<br>&gt; &gt; ~Belaid.<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; Best of luck!<br>&gt; Gus Correa<br>&gt; ---------------------------------------------------------------------<br>&gt; Gustavo Correa<br>&gt; Lamont-Doherty Earth Observatory - Columbia University<br>&gt; Palisades, NY, 10964-8000 - USA<br>&gt; ---------------------------------------------------------------------<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; PS - Your web site link to Paul Krugman is out of date.<br>&gt; Here are one to his (active) blog,<br>&gt; and another to his (no longer updated) web page: :)<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://krugman.blogs.nytimes.com/">http://krugman.blogs.nytimes.com/</a><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.princeton.edu/%7Epkrugman/">http://www.princeton.edu/~pkrugman/</a><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; &gt; Date: Tue, 1 Dec 2009 15:42:30 -0500<br>&gt; &gt; &gt; From:<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:gus@ldeo.columbia.edu">gus@ldeo.columbia.edu</a><br>&gt; &gt; &gt; To:<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; &gt; Subject: Re: [OMPI users] mpirun is using one PBS node only<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; Hi Belaid Moa<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; Belaid MOA wrote:<br>&gt; &gt; &gt; &gt; Hi everyone,<br>&gt; &gt; &gt; &gt; Here is another elementary question. I tried the following steps found<br>&gt; &gt; &gt; &gt; in the FAQ section of<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org">www.open-mpi.org</a><span class="ecxApple-converted-space">&nbsp;</span>with a simple hello world<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; example<br>&gt; &gt; &gt; &gt; (with PBS/torque):<br>&gt; &gt; &gt; &gt; $ qsub -l nodes=2 my_script.sh<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; my_script.sh is pasted below:<br>&gt; &gt; &gt; &gt; ========================<br>&gt; &gt; &gt; &gt; #!/bin/sh -l<br>&gt; &gt; &gt; &gt; #PBS -N helloTest<br>&gt; &gt; &gt; &gt; #PBS -j eo<br>&gt; &gt; &gt; &gt; echo `cat $PBS_NODEFILE` # shows two nodes: WN1 WN2<br>&gt; &gt; &gt; &gt; cd $PBS_O_WORKDIR<br>&gt; &gt; &gt; &gt; /usr/local/bin/mpirun hello<br>&gt; &gt; &gt; &gt; ========================<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; When the job is submitted, only one process is ran. When I add the<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; -n 2<br>&gt; &gt; &gt; &gt; option to the mpirun command,<br>&gt; &gt; &gt; &gt; two processes are ran but on one node only.<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; Do you have a single CPU/core per node?<br>&gt; &gt; &gt; Or are they multi-socket/multi-core?<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; Check "man mpiexec" for the options that control on which nodes and<br>&gt; &gt; &gt; slots, etc your program will run.<br>&gt; &gt; &gt; ("Man mpiexec" will tell you more than I possibly can.)<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; The default option is "-byslot",<br>&gt; &gt; &gt; which will use all "slots" (actually cores<br>&gt; &gt; &gt; or CPUs) available on a node before it moves to the next node.<br>&gt; &gt; &gt; Reading your question and your surprise with the result,<br>&gt; &gt; &gt; I would guess what you want is "-bynode" (not the default).<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; Also, if you have more than one CPU/core per node,<br>&gt; &gt; &gt; you need to put this information in your Torque/PBS "nodes" file<br>&gt; &gt; &gt; (and restart your pbs_server daemon).<br>&gt; &gt; &gt; Something like this (for 2 CPUs/cores per node):<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; WN1 np=2<br>&gt; &gt; &gt; WN2 np=2<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; I hope this helps,<br>&gt; &gt; &gt; Gus Correa<br>&gt; &gt; &gt; ---------------------------------------------------------------------<br>&gt; &gt; &gt; Gustavo Correa<br>&gt; &gt; &gt; Lamont-Doherty Earth Observatory - Columbia University<br>&gt; &gt; &gt; Palisades, NY, 10964-8000 - USA<br>&gt; &gt; &gt; ---------------------------------------------------------------------<br>&gt; &gt; &gt;<br>&gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; Note that echo `cat<br>&gt; &gt; &gt; &gt; $PBS_NODEFILE` outputs<br>&gt; &gt; &gt; &gt; the two nodes I am using: WN1 and WN2.<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; The output from ompi_info is shown below:<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; $ ompi_info | grep tm<br>&gt; &gt; &gt; &gt; MCA memory: ptmalloc2 (MCA v2.0, API v2.0, Component v1.3.3)<br>&gt; &gt; &gt; &gt; MCA ras: tm (MCA v2.0, API v2.0, Component v1.3.3)<br>&gt; &gt; &gt; &gt; MCA plm: tm (MCA v2.0, API v2.0, Component v1.3.3)<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; Any help on why openMPI/mpirun is using only one PBS node is very<br>&gt; &gt; &gt; &gt; appreciated.<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; Thanks a lot in advance and sorry for bothering you guys with my<br>&gt; &gt; &gt; &gt; elementary questions!<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; ~Belaid.<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; ------------------------------------------------------------------------<br>&gt; &gt; &gt; &gt; Windows Live: Keep your friends up to date with what you do online.<br>&gt; &gt; &gt; &gt; &lt;<a href="http://go.microsoft.com/?linkid=9691810">http://go.microsoft.com/?linkid=9691810</a>&gt;<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; ------------------------------------------------------------------------<br>&gt; &gt; &gt; &gt;<br>&gt; &gt; &gt; &gt; _______________________________________________<br>&gt; &gt; &gt; &gt; users mailing list<br>&gt; &gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; &gt; &gt;<br>&gt; &gt; &gt; _______________________________________________<br>&gt; &gt; &gt; users mailing list<br>&gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; ------------------------------------------------------------------------<br>&gt; &gt; Windows Live: Keep your friends up to date with what you do online.<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; &lt;<a href="http://go.microsoft.com/?linkid=9691810">http://go.microsoft.com/?linkid=9691810</a>&gt;<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; ------------------------------------------------------------------------<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; &gt; _______________________________________________<br>&gt; &gt; users mailing list<br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt; &gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><br>&gt; _______________________________________________<br>&gt; users mailing list<br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br>&gt;<span class="ecxApple-converted-space">&nbsp;</span><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br><br><hr>Get a great deal on Windows 7 and see how it works the way you want.<span class="ecxApple-converted-space">&nbsp;</span><a href="http://go.microsoft.com/?linkid=9691813">See the Windows 7 offers now.</a>_______________________________________________<br>users mailing list<br><a href="mailto:users@open-mpi.org">users@open-mpi.org</a><br><a href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a></div></span></blockquote></div><br></div> 		 	   		  <br /><hr />Windows Live: Make it easier for your friends to see  <a href='http://go.microsoft.com/?linkid=9691811' target='_new'>what you’re up to on Facebook.</a></body>
</html>
