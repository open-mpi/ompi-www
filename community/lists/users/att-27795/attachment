<html>
  <head>
    <meta content="text/html; charset=windows-1252"
      http-equiv="Content-Type">
  </head>
  <body bgcolor="#FFFFFF" text="#000000">
    Ralph and Marcin,<br>
    <br>
    here is a proof of concept for a fix (assert should be replaced with
    proper error handling)<br>
    for v1.10 branch.<br>
    if you have any chance to test it, please let me know the results<br>
    <br>
    Cheers,<br>
    <br>
    Gilles<br>
    <br>
    <div class="moz-cite-prefix">On 10/5/2015 1:08 PM, Gilles
      Gouaillardet wrote:<br>
    </div>
    <blockquote cite="mid:5611F7C2.9010306@rist.or.jp" type="cite"> OK,
      i'll see what i can do :-)<br>
      <br>
      <div class="moz-cite-prefix">On 10/5/2015 12:39 PM, Ralph Castain
        wrote:<br>
      </div>
      <blockquote
        cite="mid:A3D24F90-F954-4073-8308-9C5DB56AB041@open-mpi.org"
        type="cite">I would consider that a bug, myself - if there is
        some resource available, we should use it
        <div class=""><br class="">
        </div>
        <div class=""><br class="">
          <div>
            <blockquote type="cite" class="">
              <div class="">On Oct 4, 2015, at 5:42 PM, Gilles
                Gouaillardet &lt;<a moz-do-not-send="true"
                  href="mailto:gilles@rist.or.jp" class="">gilles@rist.or.jp</a>&gt;

                wrote:</div>
              <br class="Apple-interchange-newline">
              <div class="">
                <div bgcolor="#FFFFFF" text="#000000" class=""> Marcin,<br
                    class="">
                  <br class="">
                  i ran a simple test with v1.10.1rc1 under a cpuset
                  with<br class="">
                  - one core (two threads 0,16) on socket 0<br class="">
                  - two cores (two threads each 8,9,24,25) on socket 1<br
                    class="">
                  <br class="">
                  $ mpirun -np 3 -bind-to core ./hello_c <br class="">
--------------------------------------------------------------------------<br
                    class="">
                  A request was made to bind to that would result in
                  binding more<br class="">
                  processes than cpus on a resource:<br class="">
                  <br class="">
                     Bind to:     CORE<br class="">
                     Node:        rapid<br class="">
                     #processes:  2<br class="">
                     #cpus:       1<br class="">
                  <br class="">
                  You can override this protection by adding the
                  "overload-allowed"<br class="">
                  option to your binding directive.<br class="">
--------------------------------------------------------------------------<br
                    class="">
                  <br class="">
                  as you already pointed, default mapping is by socket.<br
                    class="">
                  <br class="">
                  so on one hand, we can consider this behavior is a
                  feature :<br class="">
                  we try to bind two processes to socket 0, so the
                  --oversubscribe option is required<br class="">
                  (and it does what it should :<br class="">
                  $ mpirun -np 3 -bind-to core --oversubscribe
                  -report-bindings ./hello_c <br class="">
                  [rapid:16278] MCW rank 0 bound to socket 0[core 0[hwt
                  0-1]]:
                  [BB/../../../../../../..][../../../../../../../..]<br
                    class="">
                  [rapid:16278] MCW rank 1 bound to socket 1[core 8[hwt
                  0-1]]:
                  [../../../../../../../..][BB/../../../../../../..]<br
                    class="">
                  [rapid:16278] MCW rank 2 bound to socket 0[core 0[hwt
                  0-1]]:
                  [BB/../../../../../../..][../../../../../../../..]<br
                    class="">
                  Hello, world, I am 1 of 3, (Open MPI v1.10.1rc1,
                  package: Open MPI gilles@rapid Distribution, ident:
                  1.10.1rc1, repo rev: v1.10.0-84-g15ae63f, Oct 03,
                  2015, 128)<br class="">
                  Hello, world, I am 2 of 3, (Open MPI v1.10.1rc1,
                  package: Open MPI gilles@rapid Distribution, ident:
                  1.10.1rc1, repo rev: v1.10.0-84-g15ae63f, Oct 03,
                  2015, 128)<br class="">
                  Hello, world, I am 0 of 3, (Open MPI v1.10.1rc1,
                  package: Open MPI gilles@rapid Distribution, ident:
                  1.10.1rc1, repo rev: v1.10.0-84-g15ae63f, Oct 03,
                  2015, 128)<br class="">
                  <br class="">
                  and on the other hand, we could consider ompi should
                  be a bit smarter, and uses socket 1 for task 2 since
                  socket 0 is fully allocated and there is room on
                  socket 1.<br class="">
                  <br class="">
                  Ralph, any thoughts ? bug or feature ? <br class="">
                  <br class="">
                  <br class="">
                  Marcin,<br class="">
                  <br class="">
                  you mentionned you had one failure with 1.10.1rc1 and
                  -bind-to core<br class="">
                  could you please send the full details (script,
                  allocation and output)<br class="">
                  in your slurm script, you can do<br class="">
                  srun -N $SLURM_NNODES -n $SLURM_NNODES --cpu_bind=none
                  -l grep Cpus_allowed_list /proc/self/status<br
                    class="">
                  before invoking mpirun<br class="">
                  <br class="">
                  Cheers,<br class="">
                  <br class="">
                  Gilles<br class="">
                  <br class="">
                  <div class="moz-cite-prefix">On 10/4/2015 11:55 PM,
                    marcin.krotkiewski wrote:<br class="">
                  </div>
                  <blockquote cite="mid:56113DE5.5010207@gmail.com"
                    type="cite" class=""> Hi, all,<br class="">
                    <br class="">
                    I played a bit more and it seems that the problem
                    results from<br class="">
                    <br class="">
                    trg_obj =
                    opal_hwloc_base_find_min_bound_target_under_obj()<br
                      class="">
                    <br class="">
                    called in rmaps_base_binding.c / bind_downwards
                    being wrong. I do not know the reason, but I think I
                    know when the problem happens (at least on
                    1.10.1rc1). It seems that by default openmpi maps by
                    socket. The error happens when for a given compute
                    node there is a different number of cores used on
                    each socket. Consider previously studied case (the
                    debug outputs I sent in last post). c1-8, which was
                    source of error, has 5 mpi processes assigned, and
                    the cpuset is the following:<br class="">
                    <br class="">
                    0, 5, 9, 13, 14, 16, 21, 25, 29, 30<br class="">
                    <br class="">
                    Cores 0,5 are on socket 0, cores 9, 13, 14 are on
                    socket 1. Binding progresses correctly up to and
                    including core 13 (see end of file out.1.10.1rc2,
                    before the error). That is 2 cores on socket 0, and
                    2 cores on socket 1. Error is thrown when core 14
                    should be bound - extra core on socket 1 with no
                    corresponding core on socket 0. At that point the
                    returned trg_obj points to the first core on the
                    node (os_index 0, socket 0).<br class="">
                    <br class="">
                    I have submitted a few other jobs and I always had
                    an error in such situation. Moreover, if I now use
                    --map-by core instead of socket, the error is gone,
                    and I get my expected binding:<br class="">
                    <br class="">
                    rank 0 @ compute-1-2.local  1, 17,<br class="">
                    rank 1 @ compute-1-2.local  2, 18,<br class="">
                    rank 2 @ compute-1-2.local  3, 19,<br class="">
                    rank 3 @ compute-1-2.local  4, 20,<br class="">
                    rank 4 @ compute-1-4.local  1, 17,<br class="">
                    rank 5 @ compute-1-4.local  15, 31,<br class="">
                    rank 6 @ compute-1-8.local  0, 16,<br class="">
                    rank 7 @ compute-1-8.local  5, 21,<br class="">
                    rank 8 @ compute-1-8.local  9, 25,<br class="">
                    rank 9 @ compute-1-8.local  13, 29,<br class="">
                    rank 10 @ compute-1-8.local  14, 30,<br class="">
                    rank 11 @ compute-1-13.local  3, 19,<br class="">
                    rank 12 @ compute-1-13.local  4, 20,<br class="">
                    rank 13 @ compute-1-13.local  5, 21,<br class="">
                    rank 14 @ compute-1-13.local  6, 22,<br class="">
                    rank 15 @ compute-1-13.local  7, 23,<br class="">
                    rank 16 @ compute-1-16.local  12, 28,<br class="">
                    rank 17 @ compute-1-16.local  13, 29,<br class="">
                    rank 18 @ compute-1-16.local  14, 30,<br class="">
                    rank 19 @ compute-1-16.local  15, 31,<br class="">
                    rank 20 @ compute-1-23.local  2, 18,<br class="">
                    rank 29 @ compute-1-26.local  11, 27,<br class="">
                    rank 21 @ compute-1-23.local  3, 19,<br class="">
                    rank 30 @ compute-1-26.local  13, 29,<br class="">
                    rank 22 @ compute-1-23.local  4, 20,<br class="">
                    rank 31 @ compute-1-26.local  15, 31,<br class="">
                    rank 23 @ compute-1-23.local  8, 24,<br class="">
                    rank 27 @ compute-1-26.local  1, 17,<br class="">
                    rank 24 @ compute-1-23.local  13, 29,<br class="">
                    rank 28 @ compute-1-26.local  6, 22,<br class="">
                    rank 25 @ compute-1-23.local  14, 30,<br class="">
                    rank 26 @ compute-1-23.local  15, 31,<br class="">
                    <br class="">
                    Using --map-by core seems to fix the issue on 1.8.8,
                    1.10.0 and 1.10.1rc1. However, there is still a
                    difference in behavior between 1.10.1rc1 and earlier
                    versions. In the SLURM job described in last post,
                    1.10.1rc1 fails to bind only in 1 case, while the
                    earlier versions fail in 21 out of 32 cases. You
                    mentioned there was a bug in hwloc. Not sure if it
                    can explain the difference in behavior.<br class="">
                    <br class="">
                    Hope this helps to nail this down.<br class="">
                    <br class="">
                    Marcin<br class="">
                    <br class="">
                    <br class="">
                    <br class="">
                    <br class="">
                    <div class="moz-cite-prefix">On 10/04/2015 09:55 AM,
                      Gilles Gouaillardet wrote:<br class="">
                    </div>
                    <blockquote
cite="mid:CAAkFZ5voA7Xpn9-QwLH+7E3eB_Bp4VfJYxZUh2DuyP_Aj4Epbw@mail.gmail.com"
                      type="cite" class="">Ralph,
                      <div class=""><br class="">
                      </div>
                      <div class="">I suspect ompi tries to bind to
                        threads outside the cpuset.</div>
                      <div class="">this could be pretty similar to a
                        previous issue when ompi tried to bind to cores
                        outside the cpuset.</div>
                      <div class="">/* when a core has more than one
                        thread, would ompi assume all the threads are
                        available if the core is available ? */</div>
                      <div class="">I will investigate this from
                        tomorrow</div>
                      <div class=""><br class="">
                      </div>
                      <div class="">Cheers,</div>
                      <div class=""><br class="">
                      </div>
                      <div class="">Gilles</div>
                      <div class=""><br class="">
                        On Sunday, October 4, 2015, Ralph Castain &lt;<a
                          moz-do-not-send="true"
                          class="moz-txt-link-abbreviated"
                          href="mailto:rhc@open-mpi.org"><a class="moz-txt-link-abbreviated" href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a></a>&gt;


                        wrote:<br class="">
                        <blockquote class="gmail_quote" style="margin:0
                          0 0 .8ex;border-left:1px #ccc
                          solid;padding-left:1ex">
                          <div style="word-wrap:break-word" class="">Thanks

                            - please go ahead and release that
                            allocation as I’m not going to get to this
                            immediately. I’ve got several hot irons in
                            the fire right now, and I’m not sure when
                            I’ll get a chance to track this down.
                            <div class=""><br class="">
                            </div>
                            <div class="">Gilles or anyone else who
                              might have time - feel free to take a
                              gander and see if something pops out at
                              you.</div>
                            <div class=""><br class="">
                            </div>
                            <div class="">Ralph</div>
                            <div class=""><br class="">
                            </div>
                            <div class=""><br class="">
                              <div class="">
                                <blockquote type="cite" class="">
                                  <div class="">On Oct 3, 2015, at 11:05
                                    AM, marcin.krotkiewski &lt;<a
                                      moz-do-not-send="true"
                                      class="moz-txt-link-abbreviated"
                                      href="mailto:marcin.krotkiewski@gmail.com"><a class="moz-txt-link-abbreviated" href="mailto:marcin.krotkiewski@gmail.com">marcin.krotkiewski@gmail.com</a></a>&gt;



                                    wrote:</div>
                                  <br class="">
                                  <div class="">
                                    <div text="#000000"
                                      bgcolor="#FFFFFF" class=""> <br
                                        class="">
                                      Done. I have compiled 1.10.0 and
                                      1.10.rc1 with --enable-debug and
                                      executed<br class="">
                                      <br class="">
                                      mpirun --mca rmaps_base_verbose 10
                                      --hetero-nodes --report-bindings
                                      --bind-to core -np 32 ./affinity<br
                                        class="">
                                      <br class="">
                                      In case of 1.10.rc1 I have also
                                      added :overload-allowed - output
                                      in a separate file. This option
                                      did not make much difference for
                                      1.10.0, so I did not attach it
                                      here.<br class="">
                                      <br class="">
                                      First thing I noted for 1.10.0 are
                                      lines like<br class="">
                                      <br class="">
                                      [login-0-1.local:03399]
                                      [[37945,0],0] GOT 1 CPUS<br
                                        class="">
                                      [login-0-1.local:03399]
                                      [[37945,0],0] PROC [[37945,1],27]
                                      BITMAP<br class="">
                                      [login-0-1.local:03399]
                                      [[37945,0],0] PROC [[37945,1],27]
                                      ON c1-26 IS NOT BOUND<br class="">
                                      <br class="">
                                      with an empty BITMAP.<br class="">
                                      <br class="">
                                      The SLURM environment is<br
                                        class="">
                                      <br class="">
                                      set | grep SLURM<br class="">
                                      SLURM_JOBID=12714491<br class="">
SLURM_JOB_CPUS_PER_NODE='4,2,5(x2),4,7,5'<br class="">
                                      SLURM_JOB_ID=12714491<br class="">
SLURM_JOB_NODELIST='c1-[2,4,8,13,16,23,26]'<br class="">
                                      SLURM_JOB_NUM_NODES=7<br class="">
                                      SLURM_JOB_PARTITION=normal<br
                                        class="">
                                      SLURM_MEM_PER_CPU=2048<br class="">
                                      SLURM_NNODES=7<br class="">
SLURM_NODELIST='c1-[2,4,8,13,16,23,26]'<br class="">
                                      SLURM_NODE_ALIASES='(null)'<br
                                        class="">
                                      SLURM_NPROCS=32<br class="">
                                      SLURM_NTASKS=32<br class="">
SLURM_SUBMIT_DIR=/cluster/home/marcink<br class="">
                                      SLURM_SUBMIT_HOST=login-0-1.local<br
                                        class="">
SLURM_TASKS_PER_NODE='4,2,5(x2),4,7,5'<br class="">
                                      <br class="">
                                      I have submitted an interactive
                                      job on screen for 120 hours now to
                                      work with one example, and not
                                      change it for every post :)<br
                                        class="">
                                      <br class="">
                                      If you need anything else, let me
                                      know. I could introduce some
                                      patch/printfs and recompile, if
                                      you need it.<br class="">
                                      <br class="">
                                      Marcin<br class="">
                                      <br class="">
                                      <br class="">
                                      <br class="">
                                      <div class="">On 10/03/2015 07:17
                                        PM, Ralph Castain wrote:<br
                                          class="">
                                      </div>
                                      <blockquote type="cite" class="">
                                        Rats - just realized I have no
                                        way to test this as none of the
                                        machines I can access are setup
                                        for cgroup-based multi-tenant.
                                        Is this a debug version of OMPI?
                                        If not, can you rebuild OMPI
                                        with —enable-debug?
                                        <div class=""><br class="">
                                        </div>
                                        <div class="">Then please run it
                                          with —mca rmaps_base_verbose
                                          10 and pass along the output.</div>
                                        <div class=""><br class="">
                                        </div>
                                        <div class="">Thanks</div>
                                        <div class="">Ralph</div>
                                        <div class=""><br class="">
                                        </div>
                                        <div class=""><br class="">
                                          <div class="">
                                            <blockquote type="cite"
                                              class="">
                                              <div class="">On Oct 3,
                                                2015, at 10:09 AM, Ralph
                                                Castain &lt;<a
                                                  moz-do-not-send="true"
class="moz-txt-link-abbreviated" href="mailto:rhc@open-mpi.org"><a class="moz-txt-link-abbreviated" href="mailto:rhc@open-mpi.org">rhc@open-mpi.org</a></a>&gt;




                                                wrote:</div>
                                              <br class="">
                                              <div class="">
                                                <div
                                                  style="word-wrap:break-word"
                                                  class="">What version
                                                  of slurm is this? I
                                                  might try to debug it
                                                  here. I’m not sure
                                                  where the problem lies
                                                  just yet.
                                                  <div class=""><br
                                                      class="">
                                                  </div>
                                                  <div class=""><br
                                                      class="">
                                                  </div>
                                                  <div class="">
                                                    <div class="">
                                                      <blockquote
                                                        type="cite"
                                                        class="">
                                                        <div class="">On
                                                          Oct 3, 2015,
                                                          at 8:59 AM,
                                                          marcin.krotkiewski
                                                          &lt;<a
                                                          moz-do-not-send="true"
class="moz-txt-link-abbreviated"
                                                          href="mailto:marcin.krotkiewski@gmail.com"><a class="moz-txt-link-abbreviated" href="mailto:marcin.krotkiewski@gmail.com">marcin.krotkiewski@gmail.com</a></a>&gt;




                                                          wrote:</div>
                                                        <br class="">
                                                        <div class="">
                                                          <div
                                                          text="#000000"
bgcolor="#FFFFFF" class=""> Here is the output of lstopo. In short,
                                                          (0,16) are
                                                          core 0, (1,17)
                                                          - core 1 etc.<br
                                                          class="">
                                                          <br class="">
                                                          Machine (64GB)<br
                                                          class="">
                                                            NUMANode L#0
                                                          (P#0 32GB)<br
                                                          class="">
                                                              Socket L#0
                                                          + L3 L#0
                                                          (20MB)<br
                                                          class="">
                                                                L2 L#0
                                                          (256KB) + L1d
                                                          L#0 (32KB) +
                                                          L1i L#0 (32KB)
                                                          + Core L#0<br
                                                          class="">
                                                                  PU L#0
                                                          (P#0)<br
                                                          class="">
                                                                  PU L#1
                                                          (P#16)<br
                                                          class="">
                                                                L2 L#1
                                                          (256KB) + L1d
                                                          L#1 (32KB) +
                                                          L1i L#1 (32KB)
                                                          + Core L#1<br
                                                          class="">
                                                                  PU L#2
                                                          (P#1)<br
                                                          class="">
                                                                  PU L#3
                                                          (P#17)<br
                                                          class="">
                                                                L2 L#2
                                                          (256KB) + L1d
                                                          L#2 (32KB) +
                                                          L1i L#2 (32KB)
                                                          + Core L#2<br
                                                          class="">
                                                                  PU L#4
                                                          (P#2)<br
                                                          class="">
                                                                  PU L#5
                                                          (P#18)<br
                                                          class="">
                                                                L2 L#3
                                                          (256KB) + L1d
                                                          L#3 (32KB) +
                                                          L1i L#3 (32KB)
                                                          + Core L#3<br
                                                          class="">
                                                                  PU L#6
                                                          (P#3)<br
                                                          class="">
                                                                  PU L#7
                                                          (P#19)<br
                                                          class="">
                                                                L2 L#4
                                                          (256KB) + L1d
                                                          L#4 (32KB) +
                                                          L1i L#4 (32KB)
                                                          + Core L#4<br
                                                          class="">
                                                                  PU L#8
                                                          (P#4)<br
                                                          class="">
                                                                  PU L#9
                                                          (P#20)<br
                                                          class="">
                                                                L2 L#5
                                                          (256KB) + L1d
                                                          L#5 (32KB) +
                                                          L1i L#5 (32KB)
                                                          + Core L#5<br
                                                          class="">
                                                                  PU
                                                          L#10 (P#5)<br
                                                          class="">
                                                                  PU
                                                          L#11 (P#21)<br
                                                          class="">
                                                                L2 L#6
                                                          (256KB) + L1d
                                                          L#6 (32KB) +
                                                          L1i L#6 (32KB)
                                                          + Core L#6<br
                                                          class="">
                                                                  PU
                                                          L#12 (P#6)<br
                                                          class="">
                                                                  PU
                                                          L#13 (P#22)<br
                                                          class="">
                                                                L2 L#7
                                                          (256KB) + L1d
                                                          L#7 (32KB) +
                                                          L1i L#7 (32KB)
                                                          + Core L#7<br
                                                          class="">
                                                                  PU
                                                          L#14 (P#7)<br
                                                          class="">
                                                                  PU
                                                          L#15 (P#23)<br
                                                          class="">
                                                              HostBridge
                                                          L#0<br
                                                          class="">
                                                               
                                                          PCIBridge<br
                                                          class="">
                                                                  PCI
                                                          8086:1521<br
                                                          class="">
                                                                    Net
                                                          L#0 "eth0"<br
                                                          class="">
                                                                  PCI
                                                          8086:1521<br
                                                          class="">
                                                                    Net
                                                          L#1 "eth1"<br
                                                          class="">
                                                               
                                                          PCIBridge<br
                                                          class="">
                                                                  PCI
                                                          15b3:1003<br
                                                          class="">
                                                                    Net
                                                          L#2 "ib0"<br
                                                          class="">
                                                                   
                                                          OpenFabrics
                                                          L#3 "mlx4_0"<br
                                                          class="">
                                                               
                                                          PCIBridge<br
                                                          class="">
                                                                  PCI
                                                          102b:0532<br
                                                          class="">
                                                                PCI
                                                          8086:1d02<br
                                                          class="">
                                                                  Block
                                                          L#4 "sda"<br
                                                          class="">
                                                            NUMANode L#1
                                                          (P#1 32GB) +
                                                          Socket L#1 +
                                                          L3 L#1 (20MB)<br
                                                          class="">
                                                              L2 L#8
                                                          (256KB) + L1d
                                                          L#8 (32KB) +
                                                          L1i L#8 (32KB)
                                                          + Core L#8<br
                                                          class="">
                                                                PU L#16
                                                          (P#8)<br
                                                          class="">
                                                                PU L#17
                                                          (P#24)<br
                                                          class="">
                                                              L2 L#9
                                                          (256KB) + L1d
                                                          L#9 (32KB) +
                                                          L1i L#9 (32KB)
                                                          + Core L#9<br
                                                          class="">
                                                                PU L#18
                                                          (P#9)<br
                                                          class="">
                                                                PU L#19
                                                          (P#25)<br
                                                          class="">
                                                              L2 L#10
                                                          (256KB) + L1d
                                                          L#10 (32KB) +
                                                          L1i L#10
                                                          (32KB) + Core
                                                          L#10<br
                                                          class="">
                                                                PU L#20
                                                          (P#10)<br
                                                          class="">
                                                                PU L#21
                                                          (P#26)<br
                                                          class="">
                                                              L2 L#11
                                                          (256KB) + L1d
                                                          L#11 (32KB) +
                                                          L1i L#11
                                                          (32KB) + Core
                                                          L#11<br
                                                          class="">
                                                                PU L#22
                                                          (P#11)<br
                                                          class="">
                                                                PU L#23
                                                          (P#27)<br
                                                          class="">
                                                              L2 L#12
                                                          (256KB) + L1d
                                                          L#12 (32KB) +
                                                          L1i L#12
                                                          (32KB) + Core
                                                          L#12<br
                                                          class="">
                                                                PU L#24
                                                          (P#12)<br
                                                          class="">
                                                                PU L#25
                                                          (P#28)<br
                                                          class="">
                                                              L2 L#13
                                                          (256KB) + L1d
                                                          L#13 (32KB) +
                                                          L1i L#13
                                                          (32KB) + Core
                                                          L#13<br
                                                          class="">
                                                                PU L#26
                                                          (P#13)<br
                                                          class="">
                                                                PU L#27
                                                          (P#29)<br
                                                          class="">
                                                              L2 L#14
                                                          (256KB) + L1d
                                                          L#14 (32KB) +
                                                          L1i L#14
                                                          (32KB) + Core
                                                          L#14<br
                                                          class="">
                                                                PU L#28
                                                          (P#14)<br
                                                          class="">
                                                                PU L#29
                                                          (P#30)<br
                                                          class="">
                                                              L2 L#15
                                                          (256KB) + L1d
                                                          L#15 (32KB) +
                                                          L1i L#15
                                                          (32KB) + Core
                                                          L#15<br
                                                          class="">
                                                                PU L#30
                                                          (P#15)<br
                                                          class="">
                                                                PU L#31
                                                          (P#31)<br
                                                          class="">
                                                          <br class="">
                                                          <br class="">
                                                          <br class="">
                                                          <div class="">On

                                                          10/03/2015
                                                          05:46 PM,
                                                          Ralph Castain
                                                          wrote:<br
                                                          class="">
                                                          </div>
                                                          <blockquote
                                                          type="cite"
                                                          class="">
                                                          Maybe I’m just
                                                          misreading
                                                          your HT map -
                                                          that slurm
                                                          nodelist
                                                          syntax is a
                                                          new one to me,
                                                          but they tend
                                                          to change
                                                          things around.
                                                          Could you run
                                                          lstopo on one
                                                          of those
                                                          compute nodes
                                                          and send the
                                                          output?
                                                          <div class=""><br
                                                          class="">
                                                          </div>
                                                          <div class="">I’m

                                                          just
                                                          suspicious
                                                          because I’m
                                                          not seeing a
                                                          clear pairing
                                                          of HT numbers
                                                          in your
                                                          output, but HT
                                                          numbering is
                                                          BIOS-specific
                                                          and I may just
                                                          not be
                                                          understanding
                                                          your
                                                          particular
                                                          pattern. Our
                                                          error message
                                                          is clearly
                                                          indicating
                                                          that we are
                                                          seeing
                                                          individual HTs
                                                          (and not
                                                          complete
                                                          cores)
                                                          assigned, and
                                                          I don’t know
                                                          the source of
                                                          that
                                                          confusion.</div>
                                                          <div class=""><br
                                                          class="">
                                                          </div>
                                                          <div class=""><br
                                                          class="">
                                                          <div class="">
                                                          <blockquote
                                                          type="cite"
                                                          class="">
                                                          <div class="">On

                                                          Oct 3, 2015,
                                                          at 8:28 AM,
                                                          marcin.krotkiewski
                                                          &lt;<a
                                                          moz-do-not-send="true"
class="moz-txt-link-abbreviated"
                                                          href="mailto:marcin.krotkiewski@gmail.com"><a class="moz-txt-link-abbreviated" href="mailto:marcin.krotkiewski@gmail.com">marcin.krotkiewski@gmail.com</a></a>&gt;





                                                          wrote:</div>
                                                          <br class="">
                                                          <div class="">
                                                          <div
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class=""><br
                                                          class="">
                                                          On 10/03/2015
                                                          04:38 PM,
                                                          Ralph Castain
                                                          wrote:<br
                                                          class="">
                                                          </div>
                                                          <blockquote
                                                          type="cite"
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">If
                                                          mpirun isn’t
                                                          trying to do
                                                          any binding,
                                                          then you will
                                                          of course get
                                                          the right
                                                          mapping as
                                                          we’ll just
                                                          inherit
                                                          whatever we
                                                          received.</blockquote>
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Yes.
                                                          I meant that
                                                          whatever you
                                                          received (what
                                                          SLURM gives)
                                                          is a correct
                                                          cpu map and
                                                          assigns
                                                          _whole_ CPUs,
                                                          not a single
                                                          HT to MPI
                                                          processes. In
                                                          the case
                                                          mentioned
                                                          earlier
                                                          openmpi should
                                                          start 6 tasks
                                                          on c1-30. If
                                                          HT would be
                                                          treated as
                                                          separate and
                                                          independent
                                                          cores,
                                                          sched_getaffinity
                                                          of an MPI
                                                          process
                                                          started on
                                                          c1-30 would
                                                          return a map
                                                          with 6 entries
                                                          only. In my
                                                          case it
                                                          returns a map
                                                          with 12
                                                          entries - 2
                                                          for each core.
                                                          So one 
                                                          process is in
                                                          fact allocated
                                                          both HTs, not
                                                          only one. Is
                                                          what I'm
                                                          saying
                                                          correct?</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <blockquote
                                                          type="cite"
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">Looking



                                                          at your
                                                          output, it’s
                                                          pretty clear
                                                          that you are
                                                          getting
                                                          independent
                                                          HTs assigned
                                                          and not full
                                                          cores.<span
                                                          class=""> </span></blockquote>
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">How
                                                          do you mean?
                                                          Is the above
                                                          understanding
                                                          wrong? I would
                                                          expect that on
                                                          c1-30 with
                                                          --bind-to core
                                                          openmpi should
                                                          bind to
                                                          logical cores
                                                          0 and 16 (rank
                                                          0), 1 and 17
                                                          (rank 2) and
                                                          so on. All
                                                          those logical
                                                          cores are
                                                          available in
                                                          sched_getaffinity
                                                          map, and there
                                                          is twice as
                                                          many logical
                                                          cores as there
                                                          are MPI
                                                          processes
                                                          started on the
                                                          node.</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <blockquote
                                                          type="cite"
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">My
                                                          guess is that
                                                          something in
                                                          slurm has
                                                          changed such
                                                          that it
                                                          detects that
                                                          HT has been
                                                          enabled, and
                                                          then begins
                                                          treating the
                                                          HTs as
                                                          completely
                                                          independent
                                                          cpus.
                                                          <div class=""><br
                                                          class="">
                                                          </div>
                                                          <div class="">Try


                                                          changing
                                                          “-bind-to
                                                          core” to
                                                          “-bind-to
                                                          hwthread
                                                           -use-hwthread-cpus”
                                                          and see if
                                                          that works</div>
                                                          <div class=""><br
                                                          class="">
                                                          </div>
                                                          </blockquote>
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">I
                                                          have and the
                                                          binding is
                                                          wrong. For
                                                          example, I got
                                                          this output</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          0 @
                                                          compute-1-30.local 
                                                          0,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          1 @
                                                          compute-1-30.local 
                                                          16,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Which
                                                          means that two
                                                          ranks have
                                                          been bound to
                                                          the same
                                                          physical core
                                                          (logical cores
                                                          0 and 16 are
                                                          two HTs of the
                                                          same core). If
                                                          I use
                                                          --bind-to
                                                          core, I get
                                                          the following
                                                          correct
                                                          binding</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          0 @
                                                          compute-1-30.local 
                                                          0, 16,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">The
                                                          problem is
                                                          many other
                                                          ranks get bad
                                                          binding with
                                                          'rank XXX is
                                                          not bound (or
                                                          bound to all
                                                          available
                                                          processors)'
                                                          warning.</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">But I
                                                          think I was
                                                          not entirely
                                                          correct saying
                                                          that 1.10.1rc1
                                                          did not fix
                                                          things. It
                                                          still might
                                                          have improved
                                                          something, but
                                                          not
                                                          everything.
                                                          Consider this
                                                          job:</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">SLURM_JOB_CPUS_PER_NODE='5,4,6,5(x2),7,5,9,5,7,6'</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">SLURM_JOB_NODELIST='c8-[31,34],c9-[30-32,35-36],c10-[31-34]'</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">If I
                                                          run 32 tasks
                                                          as follows
                                                          (with
                                                          1.10.1rc1)</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">mpirun




                                                          --hetero-nodes
                                                          --report-bindings



                                                          --bind-to core
                                                          -np 32
                                                          ./affinity</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">I get
                                                          the following
                                                          error:</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">--------------------------------------------------------------------------<br
                                                          class="">
                                                          A request was
                                                          made to bind
                                                          to that would
                                                          result in
                                                          binding more<br
                                                          class="">
                                                          processes than
                                                          cpus on a
                                                          resource:<br
                                                          class="">
                                                          <br class="">
                                                             Bind
                                                          to:     CORE<br
                                                          class="">
                                                            
                                                          Node:       
                                                          c9-31<br
                                                          class="">
                                                            
                                                          #processes:  2<br
                                                          class="">
                                                            
                                                          #cpus:       1<br
                                                          class="">
                                                          <br class="">
                                                          You can
                                                          override this
                                                          protection by
                                                          adding the
                                                          "overload-allowed"<br
                                                          class="">
                                                          option to your
                                                          binding
                                                          directive.<br
                                                          class="">
--------------------------------------------------------------------------<br
                                                          class="">
                                                          <br class="">
                                                          <br class="">
                                                          </span><span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">If I
                                                          now use
                                                          --bind-to
                                                          core:overload-allowed,
                                                          then openmpi
                                                          starts and
                                                          _most_ of the
                                                          threads are
                                                          bound
                                                          correctly
                                                          (i.e., map
                                                          contains two
                                                          logical cores
                                                          in ALL cases),
                                                          except this
                                                          case that
                                                          required the
                                                          overload flag:</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          15 @
                                                          compute-9-31.local  
                                                          1, 17,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          16 @
                                                          compute-9-31.local 
                                                          11, 27,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          17 @
                                                          compute-9-31.local  
                                                          2, 18,<span
                                                          class=""> </span></span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          18 @
                                                          compute-9-31.local 
                                                          12, 28,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          19 @
                                                          compute-9-31.local  
                                                          1, 17,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Note
                                                          pair 1,17 is
                                                          used twice.
                                                          The original
                                                          SLURM
                                                          delivered map
                                                          (no binding)
                                                          on this node
                                                          is</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          15 @
                                                          compute-9-31.local 
                                                          1, 2, 11, 12,
                                                          13, 17, 18,
                                                          27, 28, 29,<span
                                                          class=""> </span></span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          16 @
                                                          compute-9-31.local 
                                                          1, 2, 11, 12,
                                                          13, 17, 18,
                                                          27, 28, 29,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          17 @
                                                          compute-9-31.local 
                                                          1, 2, 11, 12,
                                                          13, 17, 18,
                                                          27, 28, 29,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          18 @
                                                          compute-9-31.local 
                                                          1, 2, 11, 12,
                                                          13, 17, 18,
                                                          27, 28, 29,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">rank
                                                          19 @
                                                          compute-9-31.local 
                                                          1, 2, 11, 12,
                                                          13, 17, 18,
                                                          27, 28, 29,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Why
                                                          does openmpi
                                                          use cores
                                                          (1,17) twice
                                                          instead of
                                                          using core
                                                          (13,29)?
                                                          Clearly, the
                                                          original
                                                          SLURM-delivered
                                                          map has 5 CPUs
                                                          included,
                                                          enough for 5
                                                          MPI processes.<span
                                                          class=""> </span></span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Cheers,</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255);float:none;display:inline!important"
                                                          class="">Marcin</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <blockquote
                                                          type="cite"
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;background-color:rgb(255,255,255)"
                                                          class="">
                                                          <div class=""><br
                                                          class="">
                                                          <div class="">
                                                          <blockquote
                                                          type="cite"
                                                          class="">
                                                          <div class="">On

                                                          Oct 3, 2015,
                                                          at 7:12 AM,
                                                          marcin.krotkiewski
                                                          &lt;<a
                                                          moz-do-not-send="true"
class="moz-txt-link-abbreviated"
                                                          href="mailto:marcin.krotkiewski@gmail.com"><a class="moz-txt-link-abbreviated" href="mailto:marcin.krotkiewski@gmail.com">marcin.krotkiewski@gmail.com</a></a>&gt;





                                                          wrote:</div>
                                                          <br class="">
                                                          <div class=""><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"
                                                          class="">
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important"
                                                          class="">On
                                                          10/03/2015
                                                          01:06 PM,
                                                          Ralph Castain
                                                          wrote:</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"
                                                          class="">
                                                          <blockquote
                                                          type="cite"
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"
                                                          class="">Thanks



                                                          Marcin.
                                                          Looking at
                                                          this, I’m
                                                          guessing that
                                                          Slurm may be
                                                          treating HTs
                                                          as “cores” -
                                                          i.e., as
                                                          independent
                                                          cpus. Any
                                                          chance that is
                                                          true?<br
                                                          class="">
                                                          </blockquote>
                                                          <span
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px;float:none;display:inline!important"
                                                          class="">Not
                                                          to the best of
                                                          my knowledge,
                                                          and at least
                                                          not
                                                          intentionally.
                                                          SLURM starts
                                                          as many
                                                          processes as
                                                          there are
                                                          physical
                                                          cores, not
                                                          threads. To
                                                          verify this,
                                                          consider this
                                                          test case:</span><br
style="font-family:Helvetica;font-size:12px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;text-align:start;text-indent:0px;text-transform:none;white-space:normal;word-spacing:0px"
                                                          class="">
                                                          </div>
                                                          </blockquote>
                                                          </div>
                                                          </div>
                                                          </blockquote>
                                                          </div>
                                                          </blockquote>
                                                          </div>
                                                          </div>
                                                          </blockquote>
                                                          </div>
                                                        </div>
                                                      </blockquote>
                                                    </div>
                                                  </div>
                                                </div>
                                              </div>
                                            </blockquote>
                                          </div>
                                        </div>
                                      </blockquote>
                                    </div>
                                  </div>
                                </blockquote>
                              </div>
                            </div>
                          </div>
                        </blockquote>
                      </div>
                      <br class="">
                      <fieldset class="mimeAttachmentHeader"></fieldset>
                      <br class="">
                      <pre class="" wrap="">_______________________________________________
users mailing list
<a moz-do-not-send="true" class="moz-txt-link-abbreviated" href="mailto:users@open-mpi.org">users@open-mpi.org</a>
Subscription: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a>
Link to this post: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/community/lists/users/2015/10/27790.php">http://www.open-mpi.org/community/lists/users/2015/10/27790.php</a></pre>
                    </blockquote>
                    <br class="">
                    <br class="">
                    <fieldset class="mimeAttachmentHeader"></fieldset>
                    <br class="">
                    <pre class="" wrap="">_______________________________________________
users mailing list
<a moz-do-not-send="true" class="moz-txt-link-abbreviated" href="mailto:users@open-mpi.org">users@open-mpi.org</a>
Subscription: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a>
Link to this post: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/community/lists/users/2015/10/27791.php">http://www.open-mpi.org/community/lists/users/2015/10/27791.php</a></pre>
                  </blockquote>
                  <br class="">
                </div>
                _______________________________________________<br
                  class="">
                users mailing list<br class="">
                <a moz-do-not-send="true"
                  href="mailto:users@open-mpi.org" class="">users@open-mpi.org</a><br
                  class="">
                Subscription: <a moz-do-not-send="true"
                  class="moz-txt-link-freetext"
                  href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a><br
                  class="">
                Link to this post: <a moz-do-not-send="true"
                  class="moz-txt-link-freetext"
                  href="http://www.open-mpi.org/community/lists/users/2015/10/27792.php">http://www.open-mpi.org/community/lists/users/2015/10/27792.php</a></div>
            </blockquote>
          </div>
          <br class="">
        </div>
        <br>
        <fieldset class="mimeAttachmentHeader"></fieldset>
        <br>
        <pre wrap="">_______________________________________________
users mailing list
<a moz-do-not-send="true" class="moz-txt-link-abbreviated" href="mailto:users@open-mpi.org">users@open-mpi.org</a>
Subscription: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a>
Link to this post: <a moz-do-not-send="true" class="moz-txt-link-freetext" href="http://www.open-mpi.org/community/lists/users/2015/10/27793.php">http://www.open-mpi.org/community/lists/users/2015/10/27793.php</a></pre>
      </blockquote>
      <br>
      <br>
      <fieldset class="mimeAttachmentHeader"></fieldset>
      <br>
      <pre wrap="">_______________________________________________
users mailing list
<a class="moz-txt-link-abbreviated" href="mailto:users@open-mpi.org">users@open-mpi.org</a>
Subscription: <a class="moz-txt-link-freetext" href="http://www.open-mpi.org/mailman/listinfo.cgi/users">http://www.open-mpi.org/mailman/listinfo.cgi/users</a>
Link to this post: <a class="moz-txt-link-freetext" href="http://www.open-mpi.org/community/lists/users/2015/10/27794.php">http://www.open-mpi.org/community/lists/users/2015/10/27794.php</a></pre>
    </blockquote>
    <br>
  </body>
</html>

