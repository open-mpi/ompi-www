<html><body><div style="color:#000; background-color:#fff; font-family:times new roman, new york, times, serif;font-size:12pt"><div>






<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Template>Normal.dotm</o:Template>
  <o:Revision>0</o:Revision>
  <o:TotalTime>0</o:TotalTime>
  <o:Pages>1</o:Pages>
  <o:Words>342</o:Words>
  <o:Characters>1950</o:Characters>
  <o:Company>Gridmatics</o:Company>
  <o:Lines>16</o:Lines>
  <o:Paragraphs>3</o:Paragraphs>
  <o:CharactersWithSpaces>2394</o:CharactersWithSpaces>
  <o:Version>12.0</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:Zoom>0</w:Zoom>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:DrawingGridHorizontalSpacing>18 pt</w:DrawingGridHorizontalSpacing>
  <w:DrawingGridVerticalSpacing>18 pt</w:DrawingGridVerticalSpacing>
  <w:DisplayHorizontalDrawingGridEvery>0</w:DisplayHorizontalDrawingGridEvery>
  <w:DisplayVerticalDrawingGridEvery>0</w:DisplayVerticalDrawingGridEvery>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:DontGrowAutofit/>
   <w:DontAutofitConstrainedTables/>
   <w:DontVertAlignInTxbx/>
  </w:Compatibility>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="276">
 </w:LatentStyles>
</xml><![endif]-->

<!--[if gte mso 10]>
<style>
 /* Style Definitions */
table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin-top:0cm;
	mso-para-margin-right:0cm;
	mso-para-margin-bottom:10.0pt;
	mso-para-margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-ascii-font-family:Cambria;
	mso-ascii-theme-font:minor-latin;
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-hansi-font-family:Cambria;
	mso-hansi-theme-font:minor-latin;}
</style>
<![endif]-->



<!--StartFragment-->

<div class="MsoNormal"><span><font face="Times New Roman"><span style="font-size: 16pt;">(reposted with&nbsp;</span><span style="font-size: 21.66666603088379px;">consolidated</span><span style="font-size: 16pt;">&nbsp;information)</span></font></span></div><div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">I have a test rig comprising 2 i7 systems 8GB RAM with Melanox III
HCA 10G cards<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">running Centos 5.7 Kernel 2.6.18-274<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Open MPI 1.4.3<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">MLNX_OFED_LINUX-1.5.3-1.0.0.2 (OFED-1.5.3-1.0.0.2):<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">On a Cisco 24 pt switch<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Normal performance is:<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">$ mpirun --mca btl openib,self -n 2 -hostfile mpi.hosts
&nbsp;PingPong<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">results in:<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">&nbsp;Max rate = 958.388867 MB/sec &nbsp;Min latency = 4.529953
usec<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">and:<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">$ mpirun --mca btl tcp,self -n 2 -hostfile mpi.hosts
&nbsp;PingPong<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Max rate = 653.547293 MB/sec &nbsp;Min latency = 19.550323 usec<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">NetPipeMPI&nbsp; results
show a max of 7.4 Gb/s at 8388605 bytes which seems fine.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 14pt; font-family: 'Times New Roman'; background-color: white; background-position: initial initial; background-repeat: initial initial; ">log_num_mtt =20 and&nbsp;log_mtts_per_seg params
=2</span><span style="font-size:10.0pt;font-family:Times"><o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">My application exchanges about a gig of data between the processes
with 2 sender and 2 consumer processes on each node with 1 additional controller
process on the starting node. <o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">The program splits the data into 64K blocks and uses non blocking
sends and receives with busy/sleep loops to monitor progress until completion.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Each process owns a single buffer for these 64K blocks.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">My problem is I see better performance under IPoIB then I do on
native IB (RDMA_CM).<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">My understanding is that IPoIB is limited to about 1G/s so I am at
a loss to know why it is faster.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">These 2 configurations are equivelant (about 8-10 seconds per
cycle)<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">mpirun --mca btl_openib_flags 2 --mca mpi_leave_pinned 1 --mca btl
tcp,self -H vh2,vh1 -np 9 --bycore prog<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">mpirun --mca btl_openib_flags 3 --mca mpi_leave_pinned 1 --mca btl
tcp,self -H vh2,vh1 -np 9 --bycore prog<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">And this one produces similar run times but seems to degrade with
repeated cycles:<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">mpirun --mca btl_openib_eager_limit 64 --mca mpi_leave_pinned 1
--mca btl openib,self -H vh2,vh1 -np 9 --bycore &nbsp;prog<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Other &nbsp;btl_openib_flags settings result in much lower
performance.&nbsp;<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Changing the first of the above configs to use openIB results in a
21 second run time at best. &nbsp;Sometimes it takes up to 5 minutes.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 14pt; font-family: 'Times New Roman'; ">In all cases, OpenIB runs in twice the time it takes TCP,except if
I push the small message max to 64K and force short messages. &nbsp;Then the
openib times are the same as TCP and no faster.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 14pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">With openib:<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">- Repeated cycles during a single run seem to slow down with each
cycle<o:p></o:p></span></div><div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">(usually by about 10 seconds).</span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">- On occasions it seems to stall indefinitely, waiting on a single
receive.&nbsp;<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 14pt; font-family: 'Times New Roman'; ">I'm &nbsp;still at a loss
as to why.&nbsp; I canâ€™t find any errors
logged during the runs.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Any ideas appreciated.<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; "><o:p>&nbsp;</o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Thanks in advance,<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size: 16pt; font-family: 'Times New Roman'; ">Randolph<o:p></o:p></span></div>

<div class="MsoNormal" style="font-family: 'times new roman', 'new york', times, serif; font-size: 12pt; "><span style="font-size:10.0pt;font-family:Times"><o:p>&nbsp;</o:p></span></div>

<!--EndFragment--></div></div></body></html>
